pipeline {

 agent {node 'buildserver'}

    stages {
				
        stage("BUILD"){
   		steps {
			echo "Buidling Composites"
	        	sh "hostname ;pwd;id -a ;ls -l ${env.SAG_HOME}"	
                	sh "${env.SAG_HOME}/common/AssetBuildEnvironment/ant/bin/ant -DSAGHome=${env.SAG_HOME} -DSAG_CI_HOME=${env.SAG_CI_HOME} -DprojectName=${env.JOB_NAME} build"
		 }
        }
	
		stage("UNITTEST WMTESUITE") {
				steps {
					echo "test"
					echo "need to adapt tests here"
				
		
            }
	    
        }
		
		stage('UPLOAD TO CC REPO'){
			steps {
				echo "uploading build composites into cc repo"
				dir ('/opt/softwareag/common/AssetBuildEnvironment/master_build/Wm_O2C_CI_CDACDLS') {
					sh 'git init'
					sh 'git pull https://github.com/vidb/WmO2CProjectACDLS.git'
					sh 'git add .'
					sh 'git config --global user.name "vidb"'
					sh 'git config --global user.email vidya.bhagwat@softwareag.com'
					sh 'git commit -am "pushing acdls"'
					sh 'git push https://vidb:vidb123@github.com/vidb/WmO2CProjectACDLS.git --all | true'
					
					
				}
			}
        }

        stage('PROVISION ASSETS'){
		
	   
			
            steps {
		 node("master"){	
		 	echo "starting deploying assets using cc"
            		echo "installing IS project"
	        	sh "/var/lib/jenkins/.sag/tools/CommandCentral/client/bin/sagcc exec provisioning assets TestServer WmO2CProjectACDLS install runtimeComponentId=integrationServer-default --server=http://dcsiqa01:8090/cce -p manage"	
				
				echo "installing MWS project"
				sh '/var/lib/jenkins/.sag/tools/CommandCentral/client/bin/sagcc exec provisioning assets TestServer WmO2CProjectACDLS install runtimeComponentId=MwsProgramFiles-default --server=http://dcsiqa01:8090/cce -p manage'
                	
			}
		}
        }
		
	stage('TEST E2E'){
			
			steps{
				echo ("Executing E2E Scenarios")
				echo "test will be started after 3 minutes"
				 // A sleep to complete asset deployment!
        			sleep 90
					sh "${env.SAG_HOME}/common/AssetBuildEnvironment/ant/bin/ant -DSAGHome=${env.SAG_HOME} -DSAG_CI_HOME=${env.SAG_CI_HOME} -DprojectName=${env.JOB_NAME} test" 
					junit 'report/'
			}
	}
	
	stage('Deploy to Next Stage') {
		steps {
				 timeout(time: 10, unit: 'SECONDS'){
				 	input 'Keep going?'
					echo "Input steps execution"
					echo "need to Manual Approval Logic here"
				}
		
            	}
  		
	}
    
}
}
